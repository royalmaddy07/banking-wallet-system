{% extends 'main.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/deactivate_account.css' %}">

<style>
    /* 1. Page Entrance Smoothness */
    .action-page-wrapper {
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.8s cubic-bezier(0.22, 1, 0.36, 1);
        padding: 50px 20px;
        display: flex;
        justify-content: center;
        min-height: 80vh;
    }

    .reveal {
        opacity: 1 !important;
        transform: translateY(0) !important;
    }

    /* 2. Compact Termination Card */
    .provision-card {
        background: white;
        padding: 35px;
        border-radius: 20px;
        width: 100%;
        max-width: 480px;
        border: 1px solid #fee2e2; /* Subtle red border */
        box-shadow: 0 15px 35px rgba(239, 68, 68, 0.05);
        transition: all 0.4s ease;
    }

    /* 3. Staggered Detail Animation */
    .account-details-box {
        background: #fdf2f2;
        border-radius: 12px;
        padding: 20px;
        margin: 25px 0;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        opacity: 0;
        transform: scale(0.95);
        transition: all 0.5s ease 0.3s;
    }

    .detail-item label {
        display: block;
        font-size: 0.65rem;
        font-weight: 800;
        color: #991b1b;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 4px;
    }

    .detail-item span {
        font-family: 'JetBrains Mono', monospace;
        font-weight: 700;
        color: #1e293b;
    }

    /* 4. Interactive Termination Button */
    .btn-deactivate {
        background: #ef4444;
        color: white;
        border: none;
        width: 100%;
        padding: 14px;
        border-radius: 10px;
        font-weight: 800;
        font-size: 0.85rem;
        text-transform: uppercase;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 15px;
    }

    .btn-deactivate:hover {
        background: #dc2626;
        box-shadow: 0 10px 20px rgba(220, 38, 38, 0.2);
        letter-spacing: 1px;
    }

    /* 5. Blocked State Glow */
    .blocked-state {
        border: 1.5px dashed #f59e0b;
        background: #fffbeb;
        padding: 25px;
        border-radius: 12px;
        text-align: center;
        animation: warning-pulse 2s infinite;
    }

    @keyframes warning-pulse {
        0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.1); }
        70% { box-shadow: 0 0 0 15px rgba(245, 158, 11, 0); }
        100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); }
    }
</style>

<div class="action-page-wrapper" id="actionWrapper">
    <div class="provision-card" id="mainCard">
        <div class="card-head">
            <div class="auth-badge" style="background: #ef4444; color: white; padding: 5px 12px; border-radius: 6px; font-size: 0.6rem; font-weight: 900; display: inline-block; margin-bottom: 12px; letter-spacing: 1px;">
                TERMINATION PROTOCOL
            </div>
            <h2 style="color: #1a365d; font-weight: 800; margin: 0; font-size: 1.5rem;">Deactivate Ledger</h2>
            <p style="color: #64748b; font-size: 0.85rem; margin-top: 8px;">
                Authorize the removal of this node from the active engine.
            </p>
        </div>

        <div class="card-body">
            <div class="account-details-box" id="detailBox">
                <div class="detail-item">
                    <label>Account Type</label>
                    <span>{{ account.accounttype }}</span>
                </div>
                <div class="detail-item">
                    <label>Live Balance</label>
                    <span style="color: {% if account.balance > 0 %}#ef4444{% else %}#10b981{% endif %};">
                        â‚¹{{ account.balance }}
                    </span>
                </div>
                <div class="detail-item" style="grid-column: span 2; border-top: 1px solid rgba(153, 27, 27, 0.1); pt: 10px;">
                    <label>Ledger ID</label>
                    <span>{{ account.accountnumber }}</span>
                </div>
            </div>

            {% if account.balance == 0 %}
                <div class="status-container ready-state" style="opacity: 0; transform: translateY(10px); transition: all 0.5s ease 0.6s;" id="formState">
                    <form method="POST" id="deactivateForm">
                        {% csrf_token %}
                        <h4 style="color: #991b1b; margin: 0 0 8px 0; font-weight: 800; font-size: 0.9rem;">Final Authorization</h4>
                        <p style="font-size: 0.75rem; color: #b91c1c; margin-bottom: 20px; line-height: 1.5;">
                            Confirm your identity to execute the deactivation sequence. This action is **irreversible**.
                        </p>

                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="display:block; font-size: 0.65rem; font-weight: 800; color: #64748b; margin-bottom: 5px; text-transform: uppercase;">Identity Confirmation</label>
                            <input type="password" name="verify_password" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="width: 100%; padding: 12px; border: 1.5px solid #f1f5f9; border-radius: 8px; box-sizing: border-box;">
                        </div>

                        <button type="submit" class="btn-deactivate" id="submitBtn">
                            Sign & Deactivate Node
                        </button>
                    </form>
                </div>
            {% else %}
                <div class="status-container blocked-state" id="blockedState">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ðŸ”’</div>
                    <h4 style="color: #92400e; margin: 0 0 5px 0; font-weight: 800;">Liquidity Detected</h4>
                    <p style="font-size: 0.75rem; color: #b45309; line-height: 1.5; margin-bottom: 20px;">
                        Ledgers with active balances cannot be terminated. Transfer <strong>â‚¹{{ account.balance }}</strong> to proceed.
                    </p>
                    
                    <a href="{% url 'transfer' %}" style="display: inline-block; background: #d97706; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 700; font-size: 0.8rem;">
                        Empty Ledger
                    </a>
                </div>
            {% endif %}

            <a href="{% url 'home' %}" style="display: block; text-align: center; margin-top: 25px; font-size: 0.8rem; color: #94a3b8; text-decoration: none; font-weight: 600; transition: color 0.3s;">
                âŸµ Abort Termination Sequence
            </a>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const wrapper = document.getElementById('actionWrapper');
        const detailBox = document.getElementById('detailBox');
        const formState = document.getElementById('formState');
        const blockedState = document.getElementById('blockedState');

        // 1. Entrance reveal
        setTimeout(() => wrapper.classList.add('reveal'), 100);

        // 2. Reveal details
        setTimeout(() => {
            detailBox.style.opacity = '1';
            detailBox.style.transform = 'scale(1)';
        }, 400);

        // 3. Reveal form or blocked state
        if(formState) {
            setTimeout(() => {
                formState.style.opacity = '1';
                formState.style.transform = 'translateY(0)';
            }, 700);
        }

        // 4. Loading State on Deactivation
        const form = document.getElementById('deactivateForm');
        if(form) {
            form.addEventListener('submit', () => {
                const btn = document.getElementById('submitBtn');
                btn.innerText = 'EXECUTING WIPE...';
                btn.style.opacity = '0.8';
                btn.style.letterSpacing = '2px';
            });
        }
    });
</script>
{% endblock %}